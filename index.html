<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="./facetion.jpg" type="image/x-icon">
    <title>T√≠nh l∆∞∆°ng + Chia c√¥ng</title>

    <!-- DaisyUI + Tailwind -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css" rel="stylesheet" type="text/css" />

    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');

        :root {
            --primary-color: #4f46e5;
            --secondary-color: #10b981;
            --accent-color: #f472b6;
            --bg-color: #f8fafc;
            --card-color: #ffffff;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Montserrat", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            height: 100%;
        }


        .parents {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(1, 1fr);
            gap: 8px;
        }

        ::placeholder {
            color: #0c0f0e;
        }



        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .app-header {
            text-align: center;
            position: relative;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: 0 0 2rem 2rem;
            box-shadow: var(--shadow);
        }

        .header-title {
            font-size: 2rem;
            font-weight: 700;
        }

        .header-subtitle {
            font-size: 2rem;
            opacity: 0.9;
            font-weight: 700;
            display: none;
        }

        /* .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    } */

        .card {
            background-color: var(--card-color);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .card-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 0.5rem;
            color: var(--text-color);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 3rem 0 1.5rem;
            text-align: center;
            color: var(--primary-color);
            position: relative;
        }

        .section-title::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .input-label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: block;
        }

        i.fas.fa-pen-to-square {
            color: red;
        }

        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .empty-ot-state span {
            color: red;
            font-style: italic;

        }

        .input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        .range-container {
            position: relative;
            width: 100%;
        }

        .range-value {
            font-size: 29px;
            font-weight: 600;
            text-align: center;
            margin-top: 0.5rem;
            color: red;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #4f46e5;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid #4f46e5;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .custumn_ot {
            display: flex;
            justify-content: space-between;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--primary-color);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            background-color: rgba(79, 70, 229, 0.1);
            color: var(--primary-color);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            margin: 0.25rem;
            font-weight: 500;
        }

        .tag-remove {
            margin-left: 0.5rem;
            font-size: 1rem;
            color: #ef4444;
            cursor: pointer;
        }

        .tag-remove:hover {
            color: #b91c1c;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
            max-height: 100px;
            overflow: auto;
        }

        .table-container {
            max-height: 200px;
            overflow-y: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-top: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        #vanta-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        th,
        td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: #f8fafc;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .results-container {
            background-color: var(--card-color);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-top: 2rem;
            position: sticky;
            display: flex;
            align-items: start;
            gap: 20px;
            justify-content: space-between;
        }

        .text-right.text-lg.font-semibold.text-success {
            font-size: 16px;
            color: #4f46e5;
        }

        .result-item {
            background-color: rgba(79, 70, 229, 0.1);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
        }

        .result-total {
            font-weight: 600;
            margin-top: 1rem;
            color: var(--primary-color);
            text-align: center;
            font-size: 16px;
        }

        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
        }

        .result-item.flex.items-center.justify-between {
            cursor: pointer;
            transition: all .3s;
        }

        .result-item.flex.items-center.justify-between:hover {
            scale: 1.05;
            transition: all .3s;
        }

        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 1rem;
            }

            .app-header {
                border-radius: 0 0 1rem 1rem;
                padding: 1.5rem 0;
            }

            .header-title {
                font-size: 1.5rem;
            }

            * Styles cho card OT c·∫£i ti·∫øn */ .ot-card {
                display: flex;
                flex-direction: column;
                height: 100%;
            }

            .ot-table-wrapper {

                flex: 1;
                min-height: 100px;
                max-height: 180px;
                overflow-y: auto;
                border-radius: 0.5rem;
                border: 1px solid var(--border-color);
                background-color: white;
                scrollbar-width: thin;
                scrollbar-color: var(--primary-color) #f0f0f0;
            }

            .ot-table-wrapper::-webkit-scrollbar {
                width: 6px;
            }

            .ot-table-wrapper::-webkit-scrollbar-track {
                background: #f0f0f0;
                border-radius: 3px;
            }

            .ot-table-wrapper::-webkit-scrollbar-thumb {
                background-color: var(--primary-color);
                border-radius: 3px;
            }

            .ot-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 0.875rem;
            }

            .ot-table th,
            .ot-table td {
                padding: 0.75rem 1rem;
                text-align: left;
                border-bottom: 1px solid var(--border-color);
            }

            .ot-table th {
                background-color: #f8fafc;
                font-weight: 600;
                position: sticky;
                top: 0;
                z-index: 10;
                box-shadow: 0 1px 0 var(--border-color);
            }

            .ot-table tr:last-child td {
                border-bottom: none;
            }

            .ot-table tr:nth-child(even) {
                background-color: #f8fafc;
            }

            .ot-table tr:hover {
                background-color: rgba(79, 70, 229, 0.05);
            }

            #otSummary {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0;
                font-size: 0.85rem;
            }

            .empty-ot-state i {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
        }

        /* Utility classes */
        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .text-accent {
            color: var(--primary-color);
        }

        .text-primary {
            color: var(--primary-color);
        }

        .text-success {
            color: var(--secondary-color);
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .font-bold {
            font-weight: 700;
        }

        .parent {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            background-color: #000000,
        }



        .div4 {
            grid-column: span 2 / span 2;
            grid-row: span 2 / span 2;
            grid-column-start: 1;
            grid-row-start: 2;
        }

        .div7 {
            grid-column-start: 3;
            grid-row-start: 1;
        }

        div.cart-ano-cacu,
        div.cart-review-cacu,
        div.cart-ano-review-cacu {
            width: 90%;
        }

        .div8 {
            grid-column-start: 3;
            grid-row-start: 2;
        }

        .div9 {
            grid-column-start: 3;
            grid-row-start: 3;
        }

        .div10 {
            grid-column-start: 4;
            grid-row-start: 1;
        }

        .div11 {
            grid-column-start: 4;
            grid-row-start: 2;
        }

        .div12 {
            grid-column-start: 4;
            grid-row-start: 3;
        }

        .flatpickr-input[readonly] {
            margin-bottom: 10px;
        }

        div#otSummary {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        footer {
            /* bottom: 0;
    color: black;
    position: fixed;
    text-align: center;
    width: 100%;
    padding-top: 100px; */
            width: 100%;
            color: #4f46e5;
            padding: 10px;
            font-size: 17px;
            font-weight: 700;
            position: absolute;
            bottom: -47px;
        }
    </style>
</head>

<body>
    <div id="vanta-bg"></div>
    <div class="animated-background" id="animated-bg"></div>

    <header class="app-header">
        <div class="container">
            <h1 class="header-title">B·∫£ng T√≠nh Ng√¢n L∆∞·ª£ng</h1>
            <p class="header-subtitle">Th√°ng <span id="currentMonthText" class="font-bold"></span></p>
        </div>
    </header>

    <div class="container">
        <div class="card-grid parent">
            <!-- Allocate Th√°ng -->
            <div class="card div1">
                <h3 class="card-title">
                    <i class="fas fa-calendar-alt card-icon"></i>
                    Allocate Th√°ng
                </h3>
                <div class="flex items-center gap-2">
                    <input type="number" id="totalWorkMonth" class="input" value="20" min="17" max="23"
                        style="width: 47% !important; text-align: center;">
                </div>
            </div>

            <!-- L∆∞∆°ng c·ªë ƒë·ªãnh -->
            <div class="card div2">
                <h3 class="card-title">
                    <i class="fas fa-money-bill-wave card-icon"></i>
                    L∆∞∆°ng c·ªë ƒë·ªãnh
                </h3>
                <div class="range-container">
                    <input type="range" id="luongRange" min="4000000" max="10000000" step="500000" value="6000000" />
                    <div id="luongText" class="range-value">6,000,000‚Ç´</div>
                </div>
            </div>



            <!-- T·ªïng ti·ªÅn nh·∫≠n ƒë∆∞·ª£c -->
            <div class="card div3">
                <h3 class="card-title">
                    <i class="fas fa-hand-holding-dollar card-icon"></i>
                    T·ªïng nh·∫≠n
                </h3>
                <div id="divTong" class="card-value text-accent" style="font-size:29px; color: red;"></div>
            </div>


            <!-- C√¥ng OT + l·ªãch - Card c·∫£i ti·∫øn -->
            <div class="card ot-card div4">
                <h3 class="card-title">
                    <i class="fas fa-clock card-icon"></i>
                    C√¥ng OT
                </h3>
                <input id="otPicker" class="input" placeholder="Ch·ªçn ng√†y OT" readonly />
                <div class="custumn_ot">
                    <div id="otSummary" class="mt-2 text-primary"></div>
                    <div id="otTotalSummary" class="mt-2"></div>
                </div>
                <div class="ot-table-wrapper">
                    <table class="ot-table">
                        <thead>
                            <tr>
                                <th>Ng√†y</th>
                                <th>Lo·∫°i OT</th>
                            </tr>
                        </thead>
                        <tbody id="otTable"></tbody>
                    </table>
                </div>

            </div>

            <!-- Ti·ªÅn OT -->
            <div class="card div5">
                <h3 class="card-title">
                    <i class="fas fa-sack-dollar card-icon"></i>
                    Ti·ªÅn OT
                </h3>
                <div id="divOT" class="card-value" style="font-size: 29px; color: red;"></div>
            </div>



            <!-- Th∆∞·ªüng c√¥ng kho√°n -->
            <div class="card div6">
                <h3 class="card-title">
                    <i class="fas fa-award card-icon"></i>
                    Th∆∞·ªüng Bonus
                </h3>
                <div id="divThuongKhoan" class="card-value" style="font-size: 29px; color: red;"></div>
            </div>

            <!-- T·ªïng c√¥ng ƒë√£ l√†m -->
            <div class="card div7">
                <h3 class="card-title">
                    <i class="fas fa-business-time card-icon"></i>
                    T·ªïng c√¥ng ƒë√£ l√†m
                </h3>
                <input type="number" id="totalWork" class="input" value="0" min="0" max="70">
            </div>



            <!-- C√¥ng kho√°n kh√¥ng Donet -->
            <div class="card div8">
                <h3 class="card-title">
                    <i class="fas fa-tasks card-icon"></i>
                    Kho√°n
                </h3>
                <div id="divKhoanKoDonet" class="card-value"></div>
            </div>
            <!-- c√¥ng bonus -->
            <div class="card div9">
                <h3 class="card-title">
                    <i class="fas fa-star card-icon"></i>
                    C√¥ng Bonus
                </h3>
                <div id="divKhoan" class="card-value"></div>
            </div>

        </div>

        <h2 class="section-title">C√¥ng Th·ª©c T√≠nh - Chia C√¥ng</h2>

        <div class="card-grid parents">
            <div class="card divs1">
                <h3 class="card-title">
                    <i class="fas fa-code-branch card-icon"></i>
                    Obj Ano
                </h3>
                <textarea id="anoInput" placeholder="Nh·∫≠p obj Ano (V√†o docs copy)" class="input"
                    style="min-height: 100px"></textarea>
                <div id="anoTags" class="tags-container"></div>
            </div>

            <div class="card divs1">
                <h3 class="card-title">
                    <i class="fas fa-check-square card-icon"></i>
                    Obj Review
                </h3>
                <textarea id="reviewInput" placeholder="Nh·∫≠p obj Review (V√†o docs copy)" class="input"
                    style="min-height: 100px"></textarea>
                <div id="reviewTags" class="tags-container"></div>
            </div>

            <div class="card divs1">
                <h3 class="card-title">
                    <i class="fas fa-calculator card-icon"></i>
                    S·ªë c√¥ng c·∫ßn l·∫•y
                </h3>
                <input id="targetWork" type="number" step="0.01" placeholder="Nh·∫≠p s·ªë c√¥ng c·∫ßn l·∫•y" class="input">
                <button onclick="getNeededTasks() ;  window.scrollBy({top: 1500, behavior: 'smooth'})" class="btn mt-4">
                    <i class="fas fa-paper-plane"></i> T√≠nh to√°n
                </button>
                <p id="noticeText" class="mt-4 text-center text-warning hidden">
                    <i class="fas fa-info-circle"></i> Ch·ªçn 1 trong 3 c·ªôt b√™n d∆∞·ªõi ƒë·ªÉ l·∫•y s·ªë c√¥ng c·∫ßn chia
                </p>

            </div>
        </div>

        <div class="results-container" style="position: relative;">
            <div class="cart-ano-cacu">
                <h3 class="card-title mb-2">
                    <i class="fas fa-list-check card-icon"></i>
                    Task Ano ƒë∆∞·ª£c ch·ªçn
                </h3>
                <div id="anoResult" class="flex flex-col gap-2"></div>
            </div>
            <div class="cart-review-cacu">

                <h3 class="card-title mb-2 mt-4" style="margin-top: 0 !important;">
                    <i class="fas fa-list-check card-icon"></i>
                    Task Review ƒë∆∞·ª£c ch·ªçn
                </h3>
                <div id="reviewResult" class="flex flex-col gap-2"></div>
            </div>
            <div class="cart-ano-review-cacu">
                <h3 class="card-title mb-2 mt-4" style="margin-top: 0 !important;">
                    <i class="fas fa-list-check card-icon"></i>
                    K·∫øt h·ª£p Ano + Review
                </h3>
                <div id="combinedResult" class="flex flex-col gap-2"></div>
            </div>
            <footer class="text-center text-sm text-gray-500 mt-6">
                ¬© 2025 B·∫£ng T√≠nh L∆∞∆°ng ‚Äî Coded with ‚ù§Ô∏è by HuyHV1<br>
            </footer>
        </div>
    </div>


    <!-- Vanta.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.birds.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

    <script>
        VANTA.BIRDS({
            el: "#vanta-bg",
            backgroundColor: 0xFFFFFF,      // M√†u n·ªÅn
            color1: 0x3399FF,               // M√†u c√°nh chim
            color2: 0xff66cc,               // M√†u c√°nh chim ph·ª•
            birdSize: 1.5,
            speedLimit: 4.0,
            separation: 50.0,
            alignment: 40.0,
            cohesion: 30.0,
            quantity: 4                   // S·ªë l∆∞·ª£ng chim
        });
        // C·∫•u tr√∫c d·ªØ li·ªáu
        const APP_DATA = {
            allocateMap: {
                3: "21/21", 4: "21/21", 5: "20/20", 6: "21/21",
                7: "23/23", 8: "21/21", 9: "20/20", 10: "23/23",
                11: "20/20", 12: "23/23"
            },
            constants: {
                phiTru: 530000
            },
            state: {
                otDates: [],
                currentMonth: new Date().getMonth() + 1
            }
        };
        // H√†m ƒë·ªãnh d·∫°ng ng√†y theo locale
        function formatDate(date) {
            return new Intl.DateTimeFormat('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            }).format(date);
        }

        // Kh·ªüi t·∫°o animated background
        function initAnimatedBackground() {
            // Th√™m animated background ƒë∆°n gi·∫£n
            const canvas = document.getElementById('animated-bg');

            // T·∫°o random stars v·ªõi hi·ªáu ·ª©ng gradient
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.style.position = 'absolute';
                star.style.width = `${Math.random() * 3 + 1}px`;
                star.style.height = star.style.width;
                star.style.borderRadius = '50%';
                star.style.backgroundColor = '#4f46e5';
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.opacity = `${Math.random() * 0.5 + 0.5}`;
                star.style.animation = `twinkle ${Math.random() * 5 + 3}s infinite alternate`;
                canvas.appendChild(star);
            }

            // Th√™m style animation
            const style = document.createElement('style');
            style.textContent = `
        @keyframes twinkle {
          0% { opacity: 0.3; transform: scale(1); }
          100% { opacity: 1; transform: scale(1.5); }
        }
      `;
            document.head.appendChild(style);
        }

        // Kh·ªüi t·∫°o Flatpickr
        function initFlatpickr() {
            flatpickr("#otPicker", {
                mode: "multiple",
                dateFormat: "d/m/Y",
                locale: "vi",
                onChange: function (selectedDates) {
                    APP_DATA.state.otDates = selectedDates;
                    updateCalculations();
                }
            });
        }

        // T√≠nh s·ªë l∆∞·ª£ng OT theo lo·∫°i
        function countOTTypes() {
            let ot1Count = 0, ot2Count = 0;
            APP_DATA.state.otDates.forEach(date => {
                const day = date.getDay();
                if (day === 0) ot2Count += 1;
                else ot1Count += 1;
            });
            return { ot1Count, ot2Count };
        }

        // H√†m t√≠nh l∆∞∆°ng
        function calculateSalary() {
            const tongCongInput = parseFloat(document.getElementById("totalWork").value) || 0;
            const luongCoBan = parseInt(document.getElementById("luongRange").value);
            const congChuan = parseInt(document.getElementById("totalWorkMonth").value);
            const tien1Cong = luongCoBan / congChuan;

            const { ot1Count, ot2Count } = countOTTypes();
            const ot1Cong = ot1Count * 0.5;
            const ot2Cong = ot2Count * 1;

            const tongCongOT = ot1Cong + ot2Cong;
            const congAllocate = Math.min(tongCongInput, congChuan);
            const congOTUsed = Math.min(tongCongOT, tongCongInput - congAllocate);

            const otUsedRatio = congOTUsed / (tongCongOT || 1);
            const usedOT1Cong = ot1Cong * otUsedRatio;
            const usedOT2Cong = ot2Cong * otUsedRatio;

            const tienOTUsed = usedOT1Cong * tien1Cong * 1.5 + usedOT2Cong * tien1Cong * 2;

            const congKhoan = tongCongInput - congAllocate - congOTUsed;
            let congDonet = 0, thuongDonet = 0;
            let congKoDonet = 0, thuongKoDonet = 0;

            // T√≠nh m·ª©c th∆∞·ªüng
            if (congKhoan >= 14) {
                congDonet = 14;
                thuongDonet = 14 * 230000 + 500000;
            } else if (congKhoan >= 12) {
                congDonet = 12;
                thuongDonet = 12 * 230000 + 300000;
            } else if (congKhoan >= 8) {
                congDonet = 8;
                thuongDonet = 8 * 200000 + 200000;
            }

            congKoDonet = congKhoan - congDonet;
            thuongKoDonet = congKoDonet >= 10 ? congKoDonet * 230000 : congKoDonet * 200000;

            const tongNhan = luongCoBan + thuongDonet + thuongKoDonet + tienOTUsed - APP_DATA.constants.phiTru;

            return {
                luongCoBan,
                congDonet,
                thuongDonet,
                congKoDonet,
                thuongKoDonet,
                tienOTUsed,
                usedOT1Cong,
                usedOT2Cong,
                tongNhan
            };
        }

        // C·∫≠p nh·∫≠t UI
        function updateUI(salaryData) {
            document.getElementById("luongText").innerHTML = `${salaryData.luongCoBan.toLocaleString()}‚Ç´`;
            document.getElementById("divKhoan").innerHTML = `${salaryData.congDonet} c√¥ng`;
            document.getElementById("divThuongKhoan").innerHTML = `${salaryData.thuongDonet.toLocaleString()}‚Ç´`;
            document.getElementById("divKhoanKoDonet").innerHTML = `
  ${salaryData.congKoDonet} c√¥ng<br>
  <span style="font-size: 29px; color: red;">
    ${salaryData.thuongKoDonet.toLocaleString()}‚Ç´
  </span>
`;

            // T√≠nh t·ªïng c√¥ng OT
            const tongCongOT = salaryData.usedOT1Cong + salaryData.usedOT2Cong;
            // Hi·ªÉn th·ªã t·ªïng OT b√™n ph·∫£i
            document.getElementById("otTotalSummary").innerHTML = `
  <div class="text-right text-lg font-semibold text-success">
    <i class="fas fa-sigma"></i> T·ªïng c√¥ng OT: ${tongCongOT.toFixed(2)} c√¥ng
  </div>
`;
            console.log(tongCongOT, "tongcongOT");

            // C·∫≠p nh·∫≠t ph·∫ßn OT
            document.getElementById("divOT").innerHTML = `${Math.round(salaryData.tienOTUsed).toLocaleString()}‚Ç´`;
            document.getElementById("otSummary").innerHTML = `
    <span><i class="fas fa-user-clock text-primary"></i> OT1: <strong>${salaryData.usedOT1Cong.toFixed(2)}</strong> c√¥ng</span>
    <span><i class="fas fa-calendar-check text-accent"></i> OT2: <strong>${salaryData.usedOT2Cong.toFixed(2)}</strong> c√¥ng</span>
    <span><i class="fas fa-book"></i> OT3: <strong>0.00</strong> c√¥ng</span>
  `;
            document.getElementById("divTong").innerHTML = `${Math.round(salaryData.tongNhan).toLocaleString()}‚Ç´`;

            document.getElementById("otTable").innerHTML = APP_DATA.state.otDates.map(d => {
                const day = d.getDay();
                const label = day === 0 ? "OT2" : "OT1";
                return `<tr><td>${d.toLocaleDateString()}</td><td>${label}</td></tr>`;
            }).join("");
        }



        // H√†m c·∫≠p nh·∫≠t t√≠nh to√°n
        function updateCalculations() {
            const salaryData = calculateSalary();
            updateUI(salaryData);
        }

        // Kh·ªüi t·∫°o event listeners
        function initEventListeners() {
            document.getElementById("totalWork").addEventListener("input", updateCalculations);
            document.getElementById("totalWorkMonth").addEventListener("input", updateCalculations);
            document.getElementById("luongRange").addEventListener("input", updateCalculations);

            // Event listeners cho input tags
            document.getElementById('anoInput').addEventListener('input', () => {
                createTagsFromInput('anoInput', 'anoTags');
            });

            document.getElementById('reviewInput').addEventListener('input', () => {
                createTagsFromInput('reviewInput', 'reviewTags');
            });
        }

        // Th√™m CSS cho badges
        function addOTStyles() {
            const style = document.createElement('style');
            style.textContent = `
    .ot-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .ot-badge.ot1 {
      background-color: rgba(79, 70, 229, 0.1);
      color: var(--primary-color);
    }
    .ot-badge.ot2 {
      background-color: rgba(244, 114, 182, 0.1);
      color: var(--accent-color);
    }
  `;
            document.head.appendChild(style);
        }

        // T·∫°o tags t·ª´ input
        function createTagsFromInput(inputId, tagsContainerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(tagsContainerId);
            container.innerHTML = '';

            const values = input.value
                .split(/[\n, ]+/)
                .map(v => v.trim())
                .filter(v => v !== '' && !isNaN(v));

            values.forEach((val, index) => {
                const tag = document.createElement('div');
                tag.className = 'tag';

                const text = document.createElement('span');
                text.textContent = val;

                const close = document.createElement('span');
                close.innerHTML = '√ó';
                close.className = 'tag-remove';
                close.onclick = () => {
                    // Xo√° gi√° tr·ªã t·ª´ textarea
                    const currentValues = input.value
                        .split(/[\n, ]+/)
                        .map(v => v.trim())
                        .filter(v => v !== '');
                    currentValues.splice(index, 1);
                    input.value = currentValues.join('\n');
                    createTagsFromInput(inputId, tagsContainerId);
                };

                tag.appendChild(text);
                tag.appendChild(close);
                container.appendChild(tag);
            });
        }

        // H√†m t√¨m tasks ph√π h·ª£p
        function getNeededTasks() {

            const target = parseFloat(document.getElementById('targetWork').value || '0');
            // Hi·ªán th√¥ng b√°o
            document.getElementById("noticeText").classList.remove("hidden");
            if (!target || target <= 0) {
                alert('Vui l√≤ng nh·∫≠p s·ªë c√¥ng c·∫ßn l·∫•y h·ª£p l·ªá.');
                return;
            }
            const getValues = id => document.getElementById(id).value
                .split(/[\n, ]+/)
                .map(v => parseFloat(v.trim()))
                .filter(v => !isNaN(v));

            const anoObjs = getValues('anoInput');
            const reviewObjs = getValues('reviewInput');

            if (anoObjs.length === 0 && reviewObjs.length === 0) {
                alert('Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt obj Ano ho·∫∑c Review.');
                return;
            }

            const calcAnoWork = obj => obj / 700 + obj / 3500;
            const calcReviewWork = obj => obj / 1750;

            // T√¨m t·ªï h·ª£p task t·ªët nh·∫•t
            function findBestCombo(objs, calcWorkFn, type, maxItems = 6) {
                const tasks = objs.map(obj => ({
                    type,
                    obj,
                    work: calcWorkFn(obj)
                }));

                let bestCombo = [];
                let bestDiff = Infinity;
                let bestSum = 0;

                // T√¨m t·ªï h·ª£p
                const allCombos = (arr, maxLen) => {
                    const res = [];
                    const generate = (start, combo) => {
                        if (combo.length > 0 && combo.length <= maxLen) res.push([...combo]);
                        if (combo.length === maxLen) return;
                        for (let i = start; i < arr.length; i++) {
                            combo.push(arr[i]);
                            generate(i + 1, combo);
                            combo.pop();
                        }
                    };
                    generate(0, []);
                    return res;
                };

                const combos = allCombos(tasks, maxItems);
                for (const combo of combos) {
                    const sum = combo.reduce((acc, cur) => acc + cur.work, 0);
                    if (sum >= target && (sum - target < bestDiff)) {
                        bestCombo = combo;
                        bestDiff = sum - target;
                        bestSum = sum;
                    }
                }

                return { selected: bestCombo, sum: bestSum };
            }

            // T√≠nh to√°n
            const anoResult = findBestCombo(anoObjs, calcAnoWork, 'Ano');
            console.log(anoResult);

            const reviewResult = findBestCombo(reviewObjs, calcReviewWork, 'Review');
            console.log(reviewResult);


            // T√≠nh to√°n k·∫øt h·ª£p c·∫£ Ano v√† Review
            const combinedResult = findBestCombo(
                [...anoObjs.map(o => ({ val: o, t: 'Ano' })), ...reviewObjs.map(o => ({ val: o, t: 'Review' }))],
                obj => obj.t === 'Ano' ? calcAnoWork(obj.val) : calcReviewWork(obj.val),
                '',
                6
            );

            console.log(combinedResult);


            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            function renderResult(arr, containerId, sum) {
                const container = document.getElementById(containerId);
                container.innerHTML = ''; // Clear c≈© n·∫øu c√≥

                if (arr.length === 0) {
                    const noResult = document.createElement('div');
                    noResult.className = 'result-item';
                    noResult.textContent = 'Kh√¥ng t√¨m ƒë∆∞·ª£c task ph√π h·ª£p.';
                    container.appendChild(noResult);
                    return;
                }

                arr.forEach(item => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item flex items-center justify-between';

                    const type = item.t || item.type || item.obj?.t || '';
                    let val = item.obj ?? item.val ?? '';
                    if (typeof val === 'object') {
                        val = val.val ?? JSON.stringify(val);
                    }


                    console.log('Item:', item);


                    const work = item.work ?? (type === 'Ano' ? calcAnoWork(val) : calcReviewWork(val));

                    resultItem.innerHTML = `
      <div>
        <i class="fas ${type === 'Ano' ? 'fa-code-branch' : 'fa-check-square'} text-primary mr-2"></i>
        <span class="font-bold">${type}</span> - ${val} obj
      </div>
      <div class="text-success">${(+work).toFixed(3)} c√¥ng</div>
    `;

                    container.appendChild(resultItem);
                });

                const totalDiv = document.createElement('div');
                totalDiv.className = 'result-total';
                totalDiv.innerHTML = `
          <i class="fas fa-calculator"></i>
          T·ªïng c√¥ng: <span class="text-primary font-bold">${sum.toFixed(3)} c√¥ng</span>
        `;
                container.appendChild(totalDiv);
            }

            renderResult(anoResult.selected, 'anoResult', anoResult.sum);
            renderResult(reviewResult.selected, 'reviewResult', reviewResult.sum);
            renderResult(combinedResult.selected, 'combinedResult', combinedResult.sum);

        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        function init() {
            // Hi·ªÉn th·ªã th√°ng hi·ªán t·∫°i
            document.getElementById("currentMonthText").textContent = APP_DATA.state.currentMonth;

            // Kh·ªüi t·∫°o UI
            initAnimatedBackground();
            initFlatpickr();
            initEventListeners();
            addOTStyles();

            // T√≠nh to√°n ban ƒë·∫ßu
            updateCalculations();
        }

        // T·∫°o tr·∫°ng th√°i tr·ªëng ban ƒë·∫ßu cho OT
        const tableWrapper = document.querySelector(".ot-table-wrapper");
        if (tableWrapper) {
            tableWrapper.innerHTML = `<div class="empty-ot-state" style="margin-top: 10px">
        <i class="fas fa-pen-to-square"></i>
        <span>T·ªîNG NH·∫¨N s·∫Ω tr·ª´ ƒëi 530k ti·ªÅn b·∫£o hi·ªÉm</span>
      </div>`;
        }

        // Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng
        document.addEventListener("DOMContentLoaded", init);

        //Check User
        async function sendVisitorInfoToDiscord() {
            const now = new Date().toLocaleString('vi-VN');
            const ua = navigator.userAgent;
            const lang = navigator.language;
            const screenSize = `${window.innerWidth}x${window.innerHeight}`;
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const platform = navigator.platform;
            const referrer = document.referrer || 'Truy c·∫≠p tr·ª±c ti·∫øp';
            const url = window.location.href;

            let ip = 'Kh√¥ng l·∫•y ƒë∆∞·ª£c IP';
            let geo = '';

            try {
            const res = await fetch('https://ipinfo.io/json?token=25f868daff1ee3'); // ƒêƒÉng k√Ω free token t·∫°i ipinfo.io
            const data = await res.json();
            ip = data.ip;
            geo = `${data.city}, ${data.region}, ${data.country}`;
            const blockedIPs = ['117.0.205.33', '58.186.90.231'];
            console.log(blockedIPs);
            
            if (blockedIPs.includes(ip)) {
            console.log(`‚õîÔ∏è Truy c·∫≠p t·ª´ IP b·ªã ch·∫∑n (${ip}) ‚Äì kh√¥ng g·ª≠i v·ªÅ Discord`);
            return;
            }
            } catch (e) {
            console.warn("Kh√¥ng th·ªÉ l·∫•y IP/location:", e);
            }

            const message = `**üì• TRUY C·∫¨P M·ªöI TR√äN WEBSITE**
        üåê URL: ${url}
        üëÄ Referrer: ${referrer}
        üïì Th·ªùi gian: ${now}
        üß≠ Timezone: ${timezone}
        üíª Thi·∫øt b·ªã: ${platform}
        üåç Ng√¥n ng·ªØ: ${lang}
        üß† Tr√¨nh duy·ªát: ${ua}
        üñ•Ô∏è M√†n h√¨nh: ${screenSize}
        üîå IP: ${ip}
        üìç V·ªã tr√≠: ${geo}`;

            fetch('https://discord.com/api/webhooks/1364874374414467193/CHkbC-q-bnOfZVDj7VsvVOJg7bv5eaIyEPQcKJU3dEVeheeS49LMChOBSVukLLok_lYg', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: message })
            });
  }

  sendVisitorInfoToDiscord();
    </script>
</body>

</html>